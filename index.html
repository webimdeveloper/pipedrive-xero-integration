<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PipeDrive to Xero Integration</title>
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        max-width: 900px;
        margin: 2rem auto;
        padding: 2rem 2.5rem;
        background: #f8fafc;
        color: #141414;
        line-height: 1.7;
      }
      header {
        border-bottom: 2px solid #0077b6;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
      }
      h1 {
        color: #0077b6;
        font-size: 2.4rem;
        margin-bottom: 0.2em;
        letter-spacing: 0.01em;
      }
      h2 {
        color: #023e8a;
        font-size: 1.5rem;
        margin-top: 2.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid #0077b6;
        padding-left: 0.6em;
        background: #e9f5fb;
      }
      h3 {
        color: #0077b6;
        font-size: 1.1rem;
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
      }
      ol,
      ul {
        padding-left: 1.5rem;
        margin-bottom: 1.2rem;
      }
      li {
        margin-bottom: 0.7em;
      }
      a {
        color: #0077b6;
        text-decoration: underline;
        word-break: break-all;
      }
      a:hover {
        color: #023e8a;
        text-decoration: none;
      }
      code {
        background: #e9ecef;
        color: #d6336c;
        padding: 0.1em 0.4em;
        border-radius: 4px;
        font-size: 0.98em;
      }
      img {
        display: block;
        margin: 2rem auto;
        max-width: 90%;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        cursor: pointer;
        transition: transform 0.2s ease-in-out;
      }
      img:hover {
        transform: scale(1.02);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      .image-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        cursor: pointer;
      }
      .modal-content {
        margin: auto;
        display: block;
        width: 90%;
        max-width: 1200px;
        max-height: 90%;
        object-fit: contain;
      }
      .close {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;
      }
      .close:hover {
        color: #bbb;
      }
      dl {
        background: #f1f5f9;
        border-radius: 6px;
        padding: 1em 1.5em;
        margin: 1em 0 2em 0;
        border-left: 4px solid #0077b6;
      }
      dt {
        font-weight: bold;
        margin-top: 0.8em;
        color: #023e8a;
      }
      dd {
        margin-left: 1.2em;
        margin-bottom: 0.5em;
      }
      blockquote {
        background: #e9f5fb;
        border-left: 4px solid #0077b6;
        margin: 1.5em 0;
        padding: 1em 1.5em;
        color: #333;
        font-style: italic;
        border-radius: 6px;
      }
      @media (max-width: 600px) {
        body {
          padding: 1rem 0.5rem;
        }
        img {
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>PipeDrive to Xero Integration</h1>
      <p style="color: #555; font-size: 1.1rem; margin-top: 0.2em">
        <strong>Business Process Documentation</strong>
      </p>
    </header>

    <main>
      <section aria-labelledby="pipedrive-section">
        <h2 id="pipedrive-section">PipeDrive</h2>
        <ol>
          <li>
            A new field <strong>"Xero Invoice"</strong> has been added to the
            <a
              href="https://ledworldptyltd.pipedrive.com/settings/fields"
              target="_blank"
              rel="noopener"
              >“Xero” group</a
            >
            in the deal for manual invoice submission.
            <figure>
              <img
                src="https://heroku.webim.space/screens/1.jpg"
                alt="PipeDrive Integration Screenshot"
                onclick="openModal(this.src)"
              />
              <figcaption
                style="text-align: center; color: #555; font-size: 0.98em"
              >
                PipeDrive: Invoice Submission Field
              </figcaption>
            </figure>
          </li>
          <li>
            Integration works through
            <a
              href="https://ledworldptyltd.pipedrive.com/settings/automation/list"
              target="_blank"
              rel="noopener"
              >Automation.</a
            >
            <figure>
              <img
                src="https://heroku.webim.space/screens/2.jpg"
                alt="Automations in PipeDrive"
                onclick="openModal(this.src)"
              />
              <figcaption
                style="text-align: center; color: #555; font-size: 0.98em"
              >
                Automations in PipeDrive
              </figcaption>
            </figure>
          </li>
          <li>
            <strong>“Xero Invoice Run”</strong> automation triggers under the one of the
            following conditions:
            <ul>
              <li>
                The deal is updated and the field
                <strong>“Xero Invoice”</strong> is set to
                <mark style="background: #e9f5fb; color: #0077b6">Run</mark>
              </li>
              <li>
                The deal is moved to stage
                <strong>“Payment Received / Preparing”</strong> for the
                <em>Banno Lighting</em> flow
              </li>
              <li>
                The deal is moved to stage
                <strong>“Payment Received”</strong> for the
                <em>LED World</em> flow
              </li>
            </ul>
               <figure>
              <img
                src="https://heroku.webim.space/screens/6.jpg"
                alt="Automation's trigger and conditions"
                onclick="openModal(this.src)"
              />
              <figcaption
                style="text-align: center; color: #555; font-size: 0.98em"
              >
                Automation's trigger and conditions
              </figcaption>
            </figure>
          </li>
          <li>
            The automation sends a request with data to the webhook:
            <dl>
              <dt>Webhook</dt>
              <dd>
                
                <a
                  href="https://ledworld.com.au/xero/invoice.php"
                  target="_blank"
                  rel="noopener"
                  >https://ledworld.com.au/xero/invoice.php</a
                >
                        <figure>
          <img
            src="https://heroku.webim.space/screens/3.jpg"
            alt="Webhook Flow Diagram"
            onclick="openModal(this.src)"
          />
          <figcaption
            style="text-align: center; color: #555; font-size: 0.98em"
          >
            Integration Webhook
          </figcaption>
        </figure>
              </dd>
              <dt>Data sent</dt>
              <dd>
                <code>dealID</code>, <code>phone</code>, <code>email</code>
              </dd>
              <dt>Additional parameter</dt>
              <dd><code>env=production</code> <a
                  href="https://ledworldptyltd.pipedrive.com/settings/automation/canvas-v2/dc428ca4-d4de-450f-b15d-ca98c5354a77"
                  target="_blank"
                  rel="noopener"
                  >(to switch off  - set to development)</a
                ></dd>
                   <figure>
              <img
                src="https://heroku.webim.space/screens/8.jpg"
                alt="Webhook settings in PipeDrive"
                onclick="openModal(this.src)"
              />
              <figcaption
                style="text-align: center; color: #555; font-size: 0.98em"
              >
                Webhook settings in PipeDrive
              </figcaption>
            </figure>
            </dl>
          </li>
          <li>
            Additionally, the automation resets the “Xero Invoice” field to
            default and adds a note "The invoice has been submitted to Xero" to the deal.
            <blockquote><strong>IMPORTANT:</strong> If the manager does not see the log entry “The invoice has been submitted to Xero” in the deal, and the Xero Invoice button is still set to “Run” (see screenshot), it means the automation did not complete successfully. Since this automation is connected to the script at https://ledworld.com.au/xero/invoice.php, both the script and the automation setup should be checked.</blockquote>
            <figure>
          <img
            src="https://heroku.webim.space/screens/12.jpg"
            alt="Actions in PipeDrive Automation"
            onclick="openModal(this.src)"
          />
          <figcaption
            style="text-align: center; color: #555; font-size: 0.98em"
          >
            <strong>IMPORTANT:If smth went wrong, the Xero Invoice button should be switch to None by manually and Automation turned off.</strong>
          </figcaption>
        </figure>
            <figure>
          <img
            src="https://heroku.webim.space/screens/10.jpg"
            alt="Actions in PipeDrive Automation"
            onclick="openModal(this.src)"
            style="max-width: 50%; height: auto;"
          />
          <figcaption
            style="text-align: center; color: #555; font-size: 0.98em"
          >
            Actions in PipeDrive Automation
          </figcaption>
        </figure>
          </li>
        </ol>
        <figure>
          <img
            src="https://heroku.webim.space/screens/9.jpg"
            alt="Note in the log and reset Xero Invoice field"
            onclick="openModal(this.src)"
          />
          <figcaption
            style="text-align: center; color: #555; font-size: 0.98em"
          >
            Note in the log and reset Xero Invoice field
          </figcaption>
        </figure>
      </section>

      <section aria-labelledby="xero-section">
        <h2 id="xero-section">Xero</h2>
        <ol>
          <li>
            The integration with Xero works via custom application - <a
              href="https://apps.xero.com/!S1hLb/us/connected"
              target="_blank"
              rel="noopener"
              >PipeDrive Invoice Prod.</a
          </li>
          <li>
            The app connects to the Xero account. To grant access, open the
            authorization page:<br />
            <a
              href="https://ledworld.com.au/xero/auth.php"
              target="_blank"
              rel="noopener"
              >https://ledworld.com.au/xero/auth.php</a
            >
          </li>
          <li>
            This page checks for an active access token. If none exists, it
            shows an authorization button.
          </li>
          <li>Clicking the button opens a form to grant account access.
            <figure>
          <img
            src="https://heroku.webim.space/screens/4.jpg"
            alt="Xero Authorization Screenshot"
            onclick="openModal(this.src)"
            style="max-width: 50%; height: auto;"
          />
          <figcaption
            style="text-align: center; color: #555; font-size: 0.98em"
          >
            Xero: Authorization Flow
          </figcaption>
        </figure>
          </li>
          <li>
            After successful submission, the app can create contacts and
            invoices in Xero.
          </li>
        </ol>
        
      </section>

      <section aria-labelledby="logic-section">
        <h2 id="logic-section">Integration Logic</h2>
        <ol>
          <li>
            The invoice handling logic is hosted at
            <a
              href="https://ledworld.com.au/xero/"
              target="_blank"
              rel="noopener"
              >https://ledworld.com.au/xero/</a
            >
          </li>
          <li>
            This includes classes for interacting with both the PipeDrive and
            Xero APIs.
          </li>
          <li>
            The webhook
            <a
              href="https://ledworld.com.au/xero/invoice.php"
              target="_blank"
              rel="noopener"
              >invoice.php</a
            >
            performs the following:
            <ul>
              <li>Receives <code>dealID</code> from PipeDrive</li>
              <li>Fetches the deal details</li>
              <li>Prepares the data set for invoice creation</li>
              <li>
                Checks if an invoice with the reference UID already exists
                     <figure>
          <img
            src="https://heroku.webim.space/screens/14.jpg"
            alt="Deal UID"
            onclick="openModal(this.src)"
            style="max-width: 50%; height: auto;"
          />
          <figcaption
            style="text-align: center; color: #555; font-size: 0.98em"
          >
            Deal UID
          </figcaption>
        </figure>
              </li>
              <li>
                Sends data to Xero to create a new invoice or update an existing
                one
              </li>
            </ul>
          </li>
        </ol>
   
      </section>
    </main>

    <!-- Modal for full-size images -->
    <div id="imageModal" class="image-modal" onclick="closeModal()">
      <span class="close" onclick="closeModal()">&times;</span>
      <img class="modal-content" id="modalImage" />
    </div>

    <script>
      function openModal(imgSrc) {
        var modal = document.getElementById("imageModal");
        var modalImg = document.getElementById("modalImage");
        modal.style.display = "block";
        modalImg.src = imgSrc;
      }

      function closeModal() {
        document.getElementById("imageModal").style.display = "none";
      }

      // Close modal when clicking outside the image
      document
        .getElementById("imageModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeModal();
          }
        });

      // Close modal with Escape key
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeModal();
        }
      });
    </script>
  </body>
</html>
